.TH SHUFFLE 1 "March 13, 1999" "\(co 1999 C. Pallier" "" "UNIX User's Manual"
.SH NAME
shuffle \- random permutation with constraints
.SH SYNOPSIS
.B shuffle
[constr='n1 n2...'] [n=<num>] [seed=<num>] [iter=<num>]

constr='n1 n2...' : sets constraints on maximum number of repetitions of labels in columns 1, 2 ...
.PP
n=<num>     : outputs <num> lines (must be less than total number of input lines)
.PP
seed=<num>  : sets the seed for the random number generator to <num>
.PP
iter=<num>  : maximum number of iterations for the search algorithm 
.PP
-h|? : displays help
.PP
-l   : displays the license

.SH DESCRIPTION
.I shuffle
reads the lines from the standard input or from a file given as argument,
and outputs them (or a subset of them) in a random order, with possible restrictions:
.PP
If no constraint is specified on the command line, all permutations are
equiprobable. Otherwise, 'constr' must be a string of numbers
separated by spaces, where the ith number specifies the maximum number
of repetitions of the labels in ith column of the output. Then, all
the permutations fullfilling these constraints are equiprobable.
.PP
If the ith number in 'constr' is 0, then there is no constraint on
repetitions in the ith column. If there are 'n' numbers in 'constr', all
the columns which rank is more than 'n' are not constrained (and are
present in the output).
.PP
.SH SAMPLES
As an example, let's consider a file 'sample.txt' containing 30 lines
formed of two columns. The 15 first lines contain '1' in the first
column and the last 15 lines contain a '2'. The second column contains
five 'A', five 'B', 'five 'C', and again five 'A', five 'B' and five
'C'.
.PP
.na
shuffle -?               # to display a short help
.br
shuffle sample.txt
.br
shuffle n=10 sample.txt  # limits output to 10 lines
.br
shuffle n=10 sample.txt  # new permutation of 10 lines
.br
shuffle n=5 seed=134 sample.txt # sets the seed of the random generator
.br
shuffle n=5 seed=134 sample.txt # you get the same permutation as before...
.br
shuffle n=8 constr='2' sample.txt # no more than 2 succesive lines with
.br
                                  # the same value in column 1
.br
shuffle n=8 constr='0 3' sample.txt # no more than 3 succesive lines with
.br
                                    # the same value in column 2
.br
shuffle n=8 constr='2 2' sample.txt # no more than 2 succesive lines with
.br
                                    # the same values in column 1 or column 2
.br
shuffle n=8 constr='1 1' sample.txt # not much randomness with strict constr
.br
.PP
Now, you will probably want to save the output of shuffle in a file. 
To do that, use the redirection operator '>':
Supposing that you want to shuffle the file 'mylist.txt' and put the result
in, say, 'newlist.txt', you would type:
.ce
shuffle mylist.txt >newlist.txt
.PP
.SH ALGORITHM
An unconstraint permutation is generated by:
.ce
for (i=nblines;i>1;i--) swap(line[i],line[random(i)]);
.PP
A constrained permutation is generated from a random unconstraint
permutation by checking from the first line downward if the
constraints are fullfilled. Every time a constraint is violated, the
algorithm search for an acceptable line further down the list, and
does a swap if it finds one. If it does not, it dumps the current
permutation and tries a whole new random permutation. 
.SH REQUIREMENTS
shuffle requires 'gawk', the GNU version of the awk programming
language (cf. www.gnu.org).
.SH DOS
It is useful to copy the files "gawk.exe" and "shuffle" in a
directory, say, "c:\\awk", and define shuffle as a macro, by adding
the following line to the file "c:\\autoexec.bat" :
.ce
	doskey shuffle=c:\\awk\\gawk.exe -f c:\\awk\\shuffle $*
.PP
 
After rebooting, the command 'shuffle' is available.  This is a better
solution than calling 'gawk -f shuffle' in a batch, because DOS batches
fail with redirections (shame on Microsoft!).
.SH LIMITS
No other limits than gawk's. This means basically that there is no
limit on the number of lines nor on the size of each lines (the
virtual memory of your computer is the limit).
.SH AUTHOR
Christophe Pallier (pallier@lscp.ehess.fr)
.SH LICENSE
shuffle can be used and distributed under the GNU License (see www.gnu.org)
.SH SEE\ ALSO
sort uniq gawk












